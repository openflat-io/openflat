import{by as z,a$ as w,q as e,b6 as W,J as P,l as g,s as G,aC as Z,aF as q,b5 as $,bc as A,d3 as J,d0 as K,c5 as B,bO as Q,d4 as X,d5 as Y,bb as ee,cG as oe,bF as ie,bp as ae,d6 as ne,bJ as re,cH as le,bv as se,bH as me,bf as R,d7 as te,d8 as ce}from"./index.c3a4c487.js";import{u as de,e as O}from"./routes.88def7e6.js";import{R as ue}from"./index.79dd958f.js";import{c as fe,I as Ne,f as be}from"./index.4209314d.js";import{T as U}from"./Table.6ec38cb9.js";import{u as pe}from"./use-login-check.e5ab6980.js";import"./index.e105ffb7.js";const V=fe(z,3),ve="data:image/svg+xml;charset=utf8,%3csvg width='22' height='22' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M8 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z' fill='%23444E60' fill-rule='evenodd'/%3e%3c/svg%3e";var j="/Users/honey/GithubRep/flat/packages/flat-components/src/components/PeriodicRoomPage/CancelSubPeriodicRoomModal.tsx";const ge=({visible:N,isCreator:t,onCancel:u,onCancelSubPeriodicRoom:l})=>{const o=w();return e(W,{footer:[e(P,{onClick:u,children:o(t?"think-again":"cancel")},"Cancel",!1,{fileName:j,lineNumber:22,columnNumber:17},void 0),e(P,{type:"primary",onClick:l,children:o("confirm")},"Ok",!1,{fileName:j,lineNumber:25,columnNumber:17},void 0)],open:N,title:o("cancel-room"),onCancel:u,children:e("span",{children:o("cancel-sub-periodic-room-tips")},void 0,!1,{fileName:j,lineNumber:33,columnNumber:13},void 0)},void 0,!1,{fileName:j,lineNumber:20,columnNumber:9},void 0)};var S="/Users/honey/GithubRep/flat/packages/flat-components/src/components/PeriodicRoomPage/MoreMenu.tsx";const he=({room:N,userName:t,inviteBaseUrl:u,isCreator:l,onCopyInvitation:o,onCancelSubPeriodicRoom:h,jumpToRoomDetailPage:y,jumpToModifyOrdinaryRoomPage:f})=>{const s=w(),[C,b]=g.exports.useState(!1),[n,c]=g.exports.useState(!1);return e(G,{children:[e(Z,{overlay:()=>e(q,{items:[{key:"room-detail",label:s("room-detail"),onClick:y},...l?[{key:"modify-room",label:s("modify-room"),onClick:f},{key:"cancel-room",label:s("cancel-room"),onClick:()=>b(!0)}]:[],{key:"invitation",label:s("invitation"),onClick:()=>c(!0)}]},void 0,!1,{fileName:S,lineNumber:40,columnNumber:25},void 0),trigger:["click"],children:e("img",{alt:s("more"),src:ve},void 0,!1,{fileName:S,lineNumber:72,columnNumber:17},void 0)},void 0,!1,{fileName:S,lineNumber:37,columnNumber:13},void 0),e(ge,{isCreator:l,visible:C,onCancel:()=>b(!1),onCancelSubPeriodicRoom:h},void 0,!1,{fileName:S,lineNumber:74,columnNumber:13},void 0),e(Ne,{baseUrl:u,room:N,userName:t,visible:n,onCancel:()=>c(!1),onCopy:k=>{o(k),$.success(s("copy-success")),c(!1)}},void 0,!1,{fileName:S,lineNumber:80,columnNumber:13},void 0)]},void 0,!0)};var T="/Users/honey/GithubRep/flat/packages/flat-components/src/components/PeriodicRoomPage/CancelPeriodicRoomModal.tsx";const ye=({visible:N,isCreator:t,onCancel:u,onCancelPeriodicRoom:l})=>{const o=w(),h=(()=>o(t?"cancel-of-periodic-rooms":"remove-room"))(),y=()=>t?e("span",{children:o("cancel-periodic-room-tips")},void 0,!1,{fileName:T,lineNumber:32,columnNumber:16},void 0):e("span",{children:o("remove-series-of-periodic-room-tips")},void 0,!1,{fileName:T,lineNumber:29,columnNumber:20},void 0);return e(W,{footer:[e(P,{onClick:u,children:o(t?"think-again":"cancel")},"Cancel",!1,{fileName:T,lineNumber:38,columnNumber:17},void 0),e(P,{type:"primary",onClick:l,children:o("confirm")},"Ok",!1,{fileName:T,lineNumber:41,columnNumber:17},void 0)],open:N,title:h,onCancel:u,children:y()},void 0,!1,{fileName:T,lineNumber:36,columnNumber:9},void 0)};var a="/Users/honey/GithubRep/flat/packages/flat-components/src/components/PeriodicRoomPage/index.tsx";const Re=({rooms:N,userName:t,inviteBaseUrl:u,isCreator:l,periodicInfo:o,onCopyInvitation:h,onCancelPeriodicRoom:y,onCancelSubPeriodicRoom:f,jumpToRoomDetailPage:s,jumpToModifyPeriodicRoomPage:C,jumpToModifyOrdinaryRoomPage:b})=>{const n=w(),c=A(),[k,x]=g.exports.useState(!1),D=g.exports.useMemo(()=>c.startsWith("zh")?J:K,[c]),I=V({locale:D},"yyyy/MM"),L=V({locale:D},"dd"),F=be("HH:mm"),E=V({locale:D},"yyyy/MM/dd iii"),_=N.some(m=>[B.Started,B.Paused].includes(m==null?void 0:m.roomStatus)),i=new Date,v=()=>{const m=(()=>{const p={};return N.forEach(d=>{if(d!=null&&d.beginTime){const r=p[I(d.beginTime)];r?r.push(d):p[I(d.beginTime)]=[d]}}),p})(),M=Object.keys(m).sort().map(p=>e("div",{children:[e("div",{className:"periodic-room-panel-month-value",children:p},void 0,!1,{fileName:a,lineNumber:85,columnNumber:21},void 0),e("div",{className:"periodic-room-panel-table-line"},void 0,!1,{fileName:a,lineNumber:86,columnNumber:21},void 0),e(U,{bordered:!1,dataSource:m[p],pagination:!1,rowKey:"roomUUID",showHeader:!1,children:[e(U.Column,{align:"left",render:(d,r)=>L(r.beginTime||i)+"\u65E5"},void 0,!1,{fileName:a,lineNumber:94,columnNumber:25},void 0),e(U.Column,{align:"center",render:(d,r)=>X(Y(r.beginTime||i),c)},void 0,!1,{fileName:a,lineNumber:101,columnNumber:25},void 0),e(U.Column,{align:"center",render:(d,r)=>F(r.beginTime||i)+"~"+F(r.endTime||i)},void 0,!1,{fileName:a,lineNumber:107,columnNumber:25},void 0),e(U.Column,{align:"center",render:(d,r)=>e(ue,{room:r},void 0,!1,{fileName:a,lineNumber:120,columnNumber:40},void 0)},void 0,!1,{fileName:a,lineNumber:117,columnNumber:25},void 0),e(U.Column,{align:"right",render:(d,r)=>e(he,{inviteBaseUrl:u,isCreator:l,jumpToModifyOrdinaryRoomPage:()=>b(r.roomUUID,r.periodicUUID),jumpToRoomDetailPage:()=>s(r.roomUUID,r.periodicUUID),room:r,userName:t,onCancelSubPeriodicRoom:()=>f(r.roomUUID,r.periodicUUID),onCopyInvitation:h},void 0,!1,{fileName:a,lineNumber:127,columnNumber:37},void 0)},void 0,!1,{fileName:a,lineNumber:123,columnNumber:25},void 0)]},void 0,!0,{fileName:a,lineNumber:87,columnNumber:21},void 0)]},p,!0,{fileName:a,lineNumber:84,columnNumber:17},void 0));return e("div",{className:"periodic-room-panel-table-container",children:M},void 0,!1,{fileName:a,lineNumber:155,columnNumber:16},void 0)};return e(G,{children:[e("div",{className:"periodic-room-panel-container",children:[e("div",{className:"periodic-room-panel-tips",children:[e("div",{className:"periodic-room-panel-tips-title",children:n("repeat-frequency",{week:Q(o.weeks,c)})},void 0,!1,{fileName:a,lineNumber:162,columnNumber:21},void 0),e("div",{className:"periodic-room-panel-tips-type",children:n("schedule-room-type",{type:n(`class-room-type.${o.roomType}`)})},void 0,!1,{fileName:a,lineNumber:167,columnNumber:21},void 0),e("div",{className:"periodic-room-panel-tips-inner",children:n("schedule-room-detail",{time:E(o.endTime),length:N.length})},void 0,!1,{fileName:a,lineNumber:172,columnNumber:21},void 0)]},void 0,!0,{fileName:a,lineNumber:161,columnNumber:17},void 0),e("div",{className:"periodic-room-panel-btn-list",children:l?e(G,{children:[e(P,{disabled:_,onClick:C,children:n("modify-periodic-rooms")},void 0,!1,{fileName:a,lineNumber:182,columnNumber:29},void 0),e(P,{danger:!0,disabled:_,onClick:()=>x(!0),children:n("cancel-of-periodic-rooms")},void 0,!1,{fileName:a,lineNumber:185,columnNumber:29},void 0)]},void 0,!0):e(P,{danger:!0,onClick:()=>x(!0),children:n("remove-periodic-room")},void 0,!1,{fileName:a,lineNumber:194,columnNumber:25},void 0)},void 0,!1,{fileName:a,lineNumber:179,columnNumber:17},void 0),v()]},void 0,!0,{fileName:a,lineNumber:160,columnNumber:13},void 0),e(ye,{isCreator:l,visible:k,onCancel:()=>x(!1),onCancelPeriodicRoom:y},void 0,!1,{fileName:a,lineNumber:201,columnNumber:13},void 0)]},void 0,!0)};var H="/Users/honey/GithubRep/flat/packages/flat-pages/src/PeriodicRoomDetailPage/index.tsx";const Se=ee(function(){pe();const t=w(),u=oe(),l=g.exports.useContext(ie),[o,h]=g.exports.useState([]),y=ae(),f=de(),s=ne.exports.useLastLocation(),C=g.exports.useContext(re);g.exports.useEffect(()=>{function i(){if(!(s!=null&&s.pathname))return f(R.HomePage);if(o.some(M=>s.pathname.includes(M)))return f(R.HomePage);y.goBack()}const v=n==null?void 0:n.periodic.title;C.configure({title:e("h1",{className:"periodic-room-detail-page-header-title",children:v},void 0,!1,{fileName:H,lineNumber:50,columnNumber:20},this),onBackPreviousPage:i})},[]);const{periodicUUID:b}=u,n=l.periodicRooms.get(b),c=n==null?void 0:n.rooms.filter(i=>!o.includes(i)).map(i=>l.rooms.get(i));if(g.exports.useEffect(()=>{l.syncPeriodicRoomInfo(b).catch(O)},[b,l]),!n||!c)return e(le,{timeMS:3*1e3},void 0,!1,{fileName:H,lineNumber:68,columnNumber:16},this);const{ownerUUID:k,ownerName:x}=n.periodic,D=se.userUUID===k,I=async(i,v)=>{if(i)try{await te({roomUUID:i,periodicUUID:v});const m=[...o,i],M=c.filter(p=>p&&!m.includes(p.roomUUID));$.success(t("the-room-has-been-cancelled")),M.length===0?f(R.HomePage):h(m)}catch(m){console.log(m),O(m)}};async function L(){try{n&&await ce(b)}catch(i){O(i)}f(R.HomePage),await $.success(t("the-room-has-been-cancelled"))}function F(i,v){f(R.RoomDetailPage,{periodicUUID:v,roomUUID:i})}function E(i,v){f(R.ModifyOrdinaryRoomPage,{periodicUUID:v,roomUUID:i})}function _(){n&&f(R.ModifyPeriodicRoomPage,{periodicUUID:b})}return e("div",{className:"periodic-room-detail-page-container",children:e(Re,{inviteBaseUrl:me,isCreator:D,jumpToModifyOrdinaryRoomPage:E,jumpToModifyPeriodicRoomPage:_,jumpToRoomDetailPage:F,periodicInfo:n.periodic,rooms:c,userName:x,onCancelPeriodicRoom:L,onCancelSubPeriodicRoom:I,onCopyInvitation:i=>navigator.clipboard.writeText(i)},void 0,!1,{fileName:H,lineNumber:139,columnNumber:13},this)},void 0,!1,{fileName:H,lineNumber:138,columnNumber:9},this)});export{Se as PeriodicRoomDetailPage,Se as default};
//# sourceMappingURL=index.c1c98f73.js.map
