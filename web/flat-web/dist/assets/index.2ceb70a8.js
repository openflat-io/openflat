import{a$ as T,q as e,ae as F,J as j,y as z,l as a,aE as H,bb as B,bd as L,dE as q,bA as J,cG as O}from"./index.85c5fa56.js";import{u as W}from"./routes.985af9a3.js";import{j as K}from"./join-room-handler.a8cdedce.js";import{u as Q}from"./lifecycle.b42b345e.js";import{u as X}from"./use-login-check.6ff90075.js";const Y="data:image/svg+xml;charset=utf8,%3csvg width='120' height='120' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M86.562 93.048a2.5 2.5 0 1 1-3.124 3.904c-13.703-10.962-33.173-10.962-46.876 0a2.5 2.5 0 1 1-3.124-3.904c15.53-12.423 37.595-12.423 53.124 0Zm5.206-64.816a2.5 2.5 0 0 1 .289 3.19l-.29.346-6.765 6.764-3.83 3.832-.001-.001-8.717 8.719-11.371 11.372-.002-.001-8.717 8.718h.001l-3.832 3.832-.001-.001-16.764 16.766a2.5 2.5 0 0 1-3.825-3.19l.29-.346 60-60a2.5 2.5 0 0 1 3.535 0ZM86.8 43.807c.458 1.99.7 4.063.7 6.193 0 15.188-12.312 27.5-27.5 27.5-2.13 0-4.202-.242-6.193-.7l4.373-4.373c.6.048 1.207.073 1.82.073 12.426 0 22.5-10.074 22.5-22.5 0-.613-.025-1.22-.073-1.82l4.373-4.373ZM60 22.5a27.41 27.41 0 0 1 19.14 7.753l-3.536 3.537A22.425 22.425 0 0 0 60 27.5c-12.426 0-22.5 10.074-22.5 22.5 0 6.06 2.395 11.559 6.29 15.604l-3.537 3.536A27.41 27.41 0 0 1 32.5 50c0-15.188 12.312-27.5 27.5-27.5Zm0 15c3.298 0 6.297 1.277 8.53 3.363l-3.539 3.539a7.5 7.5 0 0 0-10.59 10.59l-3.538 3.539A12.456 12.456 0 0 1 47.5 50c0-6.904 5.596-12.5 12.5-12.5Z' fill='%237A7B7C'/%3e%3c/svg%3e",ee="data:image/svg+xml;charset=utf8,%3csvg width='12' height='12' xmlns='http://www.w3.org/2000/svg'%3e%3cg fill='none' fill-rule='evenodd'%3e%3ccircle fill='%23FFCD00' cx='6' cy='6' r='6'/%3e%3cpath d='M6.75 5v5h-1.5V5h1.5ZM6 2a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z' fill='%231A1E21' fill-rule='nonzero'/%3e%3c/g%3e%3c/svg%3e";var D="/Users/honey/GithubRep/flat/packages/flat-components/src/components/DeviceTestPage/DeviceTestSelect/index.tsx";const G=({devices:t,isDeviceAccessible:r,currentDeviceID:n,onChange:i})=>{const l=T(),o=t!=null&&t.some(d=>d.deviceId===n)?n:void 0;return e("div",{className:"device-test-select-container",children:r?e("div",{className:"device-test-select-box",children:e(F,{value:o,onChange:i,children:t==null?void 0:t.map(({deviceId:d,label:u})=>e(F.Option,{value:d,children:u},d,!1,{fileName:D,lineNumber:34,columnNumber:33},void 0))},void 0,!1,{fileName:D,lineNumber:31,columnNumber:21},void 0)},void 0,!1,{fileName:D,lineNumber:30,columnNumber:17},void 0):e("div",{className:"device-test-select-disabled-btn",children:e(j,{icon:e("img",{src:ee},void 0,!1,{fileName:D,lineNumber:43,columnNumber:35},void 0),children:l("no-device-permission")},void 0,!1,{fileName:D,lineNumber:43,columnNumber:21},void 0)},void 0,!1,{fileName:D,lineNumber:42,columnNumber:17},void 0)},void 0,!1,{fileName:D,lineNumber:28,columnNumber:9},void 0)};var p="/Users/honey/GithubRep/flat/packages/flat-components/src/components/DeviceTestPage/CameraTest/index.tsx";const ie=({cameraDevices:t,isCameraAccessible:r,currentCameraDeviceID:n,cameraVideoStreamRef:i,setCameraDevice:l})=>{const o=T();return e("div",{className:"camera-test-container",children:[e("div",{className:"camera-test-text",children:o("camera")},void 0,!1,{fileName:p,lineNumber:29,columnNumber:13},void 0),e("div",{className:"camera-test-select-box",children:e(G,{currentDeviceID:n,devices:t,isDeviceAccessible:r,onChange:l},void 0,!1,{fileName:p,lineNumber:31,columnNumber:17},void 0)},void 0,!1,{fileName:p,lineNumber:30,columnNumber:13},void 0),e("div",{className:"camera-test-wrapper",children:[e("div",{ref:i,className:"camera-box"},void 0,!1,{fileName:p,lineNumber:39,columnNumber:17},void 0),e("div",{className:z("camera-no-accredit-box",{visible:!r}),children:[e("img",{src:Y},void 0,!1,{fileName:p,lineNumber:45,columnNumber:21},void 0),e("span",{children:o("enable-camera-permission-tip")},void 0,!1,{fileName:p,lineNumber:46,columnNumber:21},void 0)]},void 0,!0,{fileName:p,lineNumber:40,columnNumber:17},void 0)]},void 0,!0,{fileName:p,lineNumber:38,columnNumber:13},void 0)]},void 0,!0,{fileName:p,lineNumber:28,columnNumber:9},void 0)};var C="/Users/honey/GithubRep/flat/packages/flat-components/src/components/DeviceTestPage/MicrophoneTest/index.tsx";const se=({microphoneDevices:t,microphoneVolume:r,isMicrophoneAccessible:n,currentMicrophoneDeviceID:i,setMicrophoneDevice:l})=>{const o=T();return e("div",{className:"microphone-test-container",children:[e("div",{className:"microphone-test-text",children:o("microphone")},void 0,!1,{fileName:C,lineNumber:27,columnNumber:13},void 0),e("div",{className:"microphone-text-select-box",children:e(G,{currentDeviceID:i,devices:t,isDeviceAccessible:n,onChange:l},void 0,!1,{fileName:C,lineNumber:29,columnNumber:17},void 0)},void 0,!1,{fileName:C,lineNumber:28,columnNumber:13},void 0),e("div",{className:"microphone-test-wrapper",children:[e("div",{className:"microphone-test-volume",style:{width:`${r*100}%`}},void 0,!1,{fileName:C,lineNumber:37,columnNumber:17},void 0),e("div",{className:"microphone-test-mask"},void 0,!1,{fileName:C,lineNumber:41,columnNumber:17},void 0)]},void 0,!0,{fileName:C,lineNumber:36,columnNumber:13},void 0)]},void 0,!0,{fileName:C,lineNumber:26,columnNumber:9},void 0)},ae="data:image/svg+xml;charset=utf8,%3csvg width='24' height='24' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M6.5 5v14l11-7z' fill='%235D5D5D' fill-rule='evenodd'/%3e%3c/svg%3e",le="data:image/svg+xml;charset=utf8,%3csvg width='22' height='22' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M7 5h2v12H7zm6 0h2v12h-2z' fill='%23444E60' fill-rule='evenodd'/%3e%3c/svg%3e",te="/openflat/assets/Goldberg Variations_ BWV 988 - 05 - Variatio 4 a 1 Clav.e8025df4.mp3";var x="/Users/honey/GithubRep/flat/packages/flat-components/src/components/DeviceTestPage/SpeakerTest/index.tsx";const oe=({speakerDevices:t,speakerTestFileName:r,currentSpeakerDeviceID:n,isSpeakerAccessible:i,audioResourceSrc:l,setSpeakerDevice:o})=>{const d=T(),[u,v]=a.exports.useState(!1),h=a.exports.useRef(null);a.exports.useEffect(()=>()=>{var f;return(f=h.current)==null?void 0:f.pause()},[]);const N=()=>{var f,m;u?(f=h.current)==null||f.pause():(m=h.current)==null||m.play(),v(!u)};return e("div",{className:"speaker-test-container",children:[e("div",{className:"speaker-test-text",children:d("speaker")},void 0,!1,{fileName:x,lineNumber:42,columnNumber:13},void 0),e("div",{className:"speaker-text-select-box",children:e(G,{currentDeviceID:n,devices:t,isDeviceAccessible:i,onChange:o},void 0,!1,{fileName:x,lineNumber:44,columnNumber:17},void 0)},void 0,!1,{fileName:x,lineNumber:43,columnNumber:13},void 0),e("div",{className:"speaker-test-output-box",children:[e("audio",{ref:h,loop:!0,src:l||te},void 0,!1,{fileName:x,lineNumber:52,columnNumber:17},void 0),e(j,{icon:e("img",{src:u?le:ae},void 0,!1,{fileName:x,lineNumber:57,columnNumber:31},void 0),onClick:N,children:r},void 0,!1,{fileName:x,lineNumber:57,columnNumber:17},void 0)]},void 0,!0,{fileName:x,lineNumber:51,columnNumber:13},void 0)]},void 0,!0,{fileName:x,lineNumber:41,columnNumber:9},void 0)};var c="/Users/honey/GithubRep/flat/packages/flat-components/src/components/DeviceTestPage/index.tsx";const ce=({cameraDevices:t,speakerDevices:r,microphoneDevices:n,audioResourceSrc:i,speakerTestFileName:l,currentCameraDeviceID:o,currentSpeakerDeviceID:d,currentMicrophoneDeviceID:u,microphoneVolume:v,isCameraAccessible:h,isSpeakerAccessible:N,isMicrophoneAccessible:f,cameraVideoStreamRef:m,setCameraDevice:I,setMicrophoneDevice:b,setSpeakerDevice:w,toggleDeviceTest:y,joinRoom:M})=>{const S=T();return e("div",{className:"device-test-panel-container",children:[e("div",{className:"device-test-panel-title-box",children:S("device-test")},void 0,!1,{fileName:c,lineNumber:57,columnNumber:13},void 0),e("div",{className:"device-test-panel-inner-box",children:[e("div",{className:"device-test-panel-inner-left",children:e(ie,{cameraDevices:t,cameraVideoStreamRef:m,currentCameraDeviceID:o,isCameraAccessible:h,setCameraDevice:I},void 0,!1,{fileName:c,lineNumber:60,columnNumber:21},void 0)},void 0,!1,{fileName:c,lineNumber:59,columnNumber:17},void 0),e("div",{className:"device-test-panel-inner-right",children:[e(oe,{audioResourceSrc:i,currentSpeakerDeviceID:d,isSpeakerAccessible:N,setSpeakerDevice:w,speakerDevices:r,speakerTestFileName:l},void 0,!1,{fileName:c,lineNumber:69,columnNumber:21},void 0),e(se,{currentMicrophoneDeviceID:u,isMicrophoneAccessible:f,microphoneDevices:n,microphoneVolume:v,setMicrophoneDevice:b},void 0,!1,{fileName:c,lineNumber:77,columnNumber:21},void 0)]},void 0,!0,{fileName:c,lineNumber:68,columnNumber:17},void 0)]},void 0,!0,{fileName:c,lineNumber:58,columnNumber:13},void 0),e("div",{className:"device-test-panel-tips-box",children:[e("div",{className:"device-test-panel-tips-radio",children:e(H,{onClick:y,children:S("close-tip")},void 0,!1,{fileName:c,lineNumber:88,columnNumber:21},void 0)},void 0,!1,{fileName:c,lineNumber:87,columnNumber:17},void 0),e("div",{className:"device-test-panel-join-btn",children:e(j,{type:"primary",onClick:M,children:S("join-room")},void 0,!1,{fileName:c,lineNumber:91,columnNumber:21},void 0)},void 0,!1,{fileName:c,lineNumber:90,columnNumber:17},void 0)]},void 0,!0,{fileName:c,lineNumber:86,columnNumber:13},void 0)]},void 0,!0,{fileName:c,lineNumber:56,columnNumber:9},void 0)};var A="/Users/honey/GithubRep/flat/packages/flat-pages/src/DevicesTestPage/index.tsx";const Ne=B(function(){const r=W(),n=a.exports.useContext(L),i=q("videoChat"),l=a.exports.useContext(J),o=Q();X();const{roomUUID:d}=O(),u=a.exports.useRef(null),[v,h]=a.exports.useState([]),[N,f]=a.exports.useState([]),[m,I]=a.exports.useState(""),[b,w]=a.exports.useState(""),[y,M]=a.exports.useState(!0),[S,R]=a.exports.useState(!0),[U,Z]=a.exports.useState(0);return a.exports.useEffect(()=>{if(!i)return;const s=i.getTestAvatar();if(s){s.enableCamera(!0),s.enableMic(!0),s.setElement(u.current);const g=window.setInterval(()=>{Z(Math.min(s.getVolumeLevel()+Math.random()*.05,1))},50);return()=>{window.clearInterval(g),s.enableCamera(!1),s.enableMic(!1),s.setElement(null)}}},[i,u]),a.exports.useEffect(()=>{if(!i)return;const s=()=>{M(!1)},g=()=>{o(i.getCameraDevices()).then(P=>{const k=P.filter(E=>E.deviceId);h(k),M(k.length>0)}).catch(s)},V=()=>{o(i.getMicDevices()).then(P=>{const k=P.filter(E=>E.deviceId);f(k),R(k.length>0)}).catch(s)},_=i.events.on("camera-changed",g),$=i.events.on("mic-changed",V);return g(),V(),()=>{_(),$()}},[i,o]),a.exports.useEffect(()=>{i&&m&&i.setCameraID(m).catch(()=>{M(!1)})},[i,m]),a.exports.useEffect(()=>{i&&b&&i.setMicID(b).catch(()=>{R(!1)})},[i,b]),a.exports.useEffect(()=>{if(v.length>0&&!m){const s=l.cameraId;s&&v.find(g=>g.deviceId===s)?I(s):I(v[0].deviceId)}},[l,m,v]),a.exports.useEffect(()=>{if(N.length>0&&!b){const s=l.microphoneId;s&&N.some(g=>g.deviceId===s)?w(s):w(N[0].deviceId)}},[l,b,N]),e("div",{className:"device-test-page-container",children:e("div",{className:"device-test-panel-box",children:e(ce,{cameraDevices:v,cameraVideoStreamRef:u,currentCameraDeviceID:m,currentMicrophoneDeviceID:b,currentSpeakerDeviceID:"default browser",isCameraAccessible:y,isMicrophoneAccessible:S,isSpeakerAccessible:!0,joinRoom:async()=>{l.updateCameraId(m),l.updateMicrophoneId(b),await K(d,r)},microphoneDevices:N,microphoneVolume:U,setCameraDevice:I,setMicrophoneDevice:w,setSpeakerDevice:()=>null,speakerTestFileName:"Music",toggleDeviceTest:()=>n.toggleDeviceTest()},void 0,!1,{fileName:A,lineNumber:159,columnNumber:17},this)},void 0,!1,{fileName:A,lineNumber:158,columnNumber:13},this)},void 0,!1,{fileName:A,lineNumber:157,columnNumber:9},this)});export{Ne as DevicesTestPage,Ne as default};
//# sourceMappingURL=index.2ceb70a8.js.map
