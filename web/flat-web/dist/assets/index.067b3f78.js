import{bb as w,a$ as C,l as s,q as e,b6 as k,J as b,bw as y,bx as A}from"./index.c3a4c487.js";import{u as S}from"./lifecycle.d696a840.js";var a="/Users/honey/GithubRep/flat/packages/flat-pages/src/components/AppUpgradeModal/index.tsx";function F(){const c=S(),t=s.exports.useContext(y),o=s.exports.useContext(A),[l,i]=s.exports.useState(null),[u,p]=s.exports.useState(!1),[m,f]=s.exports.useState(0),[n,d]=s.exports.useState(!1),[h,v]=s.exports.useState(!1),g=s.exports.useCallback(()=>d(!0),[]),x=s.exports.useCallback(()=>d(!1),[]),U=s.exports.useCallback(async()=>{if(o&&t){p(!0);try{const r=await c(o.getUpdateInfo());p(!1),!r||!r.hasNewVersion||r.version===t.appVersion?console.log("[Auto Updater] No new version"):(console.log("[Auto Updater] New version found",r),i(r))}catch(r){console.error(r)}}},[o,t,c]);return s.exports.useEffect(()=>{if(o&&n&&l){const r=o.onUpdateProgress(N=>{N.status?f(N.percent):v(!0)});return o.startUpdate(l.prereleaseTag),r}},[o,n,l]),{checkUpdate:U,updateInfo:l,setUpdateInfo:i,loading:u,percent:m,isStarted:n,isFailed:h,startUpdate:g,cancelUpdate:x}}const E=w(function(){const t=C(),{checkUpdate:o,updateInfo:l,setUpdateInfo:i,percent:u,isStarted:p,isFailed:m,startUpdate:f,cancelUpdate:n}=F();s.exports.useEffect(()=>{o()},[o]);const d=s.exports.useCallback(()=>{n(),i(null)},[n,i]);return e(k,{closable:!1,footer:[],keyboard:!1,maskClosable:!1,open:l!==null,title:e("div",{className:"app-upgrade-modal-title",children:t("version-updates")},void 0,!1,{fileName:a,lineNumber:119,columnNumber:20},this),width:386,wrapClassName:"app-upgrade-modal-container",onCancel:d,children:p?e("div",{children:[e("span",{className:"app-upgrade-modal-font",children:[t("downloading")," (",u.toFixed(2),"%)..."]},void 0,!0,{fileName:a,lineNumber:126,columnNumber:21},this),e("div",{className:"app-upgrade-modal-progress"},void 0,!1,{fileName:a,lineNumber:129,columnNumber:21},this),e("div",{className:"app-upgrade-active-progress",style:{width:`${u}%`}},void 0,!1,{fileName:a,lineNumber:130,columnNumber:21},this),m&&e("div",{children:[e("span",{className:"app-upgrade-modal-font",children:t("update-failed-tips")},void 0,!1,{fileName:a,lineNumber:133,columnNumber:29},this),e("div",{className:"app-upgrade-modal-btn",children:e(b,{type:"primary",onClick:()=>window.close(),children:t("confirm")},void 0,!1,{fileName:a,lineNumber:137,columnNumber:33},this)},void 0,!1,{fileName:a,lineNumber:136,columnNumber:29},this)]},void 0,!0,{fileName:a,lineNumber:132,columnNumber:25},this)]},void 0,!0,{fileName:a,lineNumber:125,columnNumber:17},this):e("div",{children:[e("span",{className:"app-upgrade-modal-font",children:t("new-version-tips",{version:(l==null?void 0:l.version)||" "})},void 0,!1,{fileName:a,lineNumber:146,columnNumber:21},this),e("div",{className:"app-upgrade-modal-btn",children:e(b,{type:"primary",onClick:f,children:t("update-now")},void 0,!1,{fileName:a,lineNumber:150,columnNumber:25},this)},void 0,!1,{fileName:a,lineNumber:149,columnNumber:21},this)]},void 0,!0,{fileName:a,lineNumber:145,columnNumber:17},this)},void 0,!1,{fileName:a,lineNumber:113,columnNumber:9},this)});export{E as A};
//# sourceMappingURL=index.067b3f78.js.map
