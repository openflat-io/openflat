{"version":3,"file":"index.44dab42c.js","sources":["../../../../packages/flat-pages/src/BigClassPage/index.tsx"],"sourcesContent":["import \"./BigClassPage.less\";\n\nimport { message } from \"antd\";\nimport {\n    CloudRecordBtn,\n    Timer,\n    NetworkStatus,\n    RoomInfo,\n    TopBar,\n    TopBarDivider,\n    TopBarRightBtn,\n    SVGExit,\n    SVGMenuUnfold,\n    SVGMenuFold,\n    SVGScreenSharing,\n} from \"flat-components\";\nimport { observer } from \"mobx-react-lite\";\nimport React, { useContext, useEffect, useState } from \"react\";\nimport { useTranslate } from \"@netless/flat-i18n\";\nimport { RoomStatus } from \"@netless/flat-server-api\";\nimport { ChatPanel } from \"../components/ChatPanel\";\nimport { RoomStatusStoppedModal } from \"../components/ClassRoom/RoomStatusStoppedModal\";\nimport { CloudStorageButton } from \"../components/CloudStorageButton\";\nimport {\n    ExitRoomConfirm,\n    ExitRoomConfirmType,\n    useExitRoomConfirmModal,\n} from \"../components/ExitRoomConfirm\";\nimport InviteButton from \"../components/InviteButton\";\nimport { RealtimePanel } from \"../components/RealtimePanel\";\nimport { Whiteboard } from \"../components/Whiteboard\";\nimport { RTCAvatar } from \"../components/RTCAvatar\";\nimport { ShareScreen } from \"../components/ShareScreen\";\nimport { useLoginCheck } from \"../utils/use-login-check\";\nimport { withClassroomStore, WithClassroomStoreProps } from \"../utils/with-classroom-store\";\nimport { WindowsSystemBtnContext } from \"../components/StoreProvider\";\nimport { ShareScreenPicker } from \"../components/ShareScreen/ShareScreenPicker\";\nimport { ExtraPadding } from \"../components/ExtraPadding\";\n\nexport type BigClassPageProps = {};\n\nexport const BigClassPage = withClassroomStore<BigClassPageProps>(\n    observer<WithClassroomStoreProps<BigClassPageProps>>(function BigClassPage({ classroomStore }) {\n        useLoginCheck();\n\n        const t = useTranslate();\n\n        const whiteboardStore = classroomStore.whiteboardStore;\n        const windowsBtn = useContext(WindowsSystemBtnContext);\n\n        const { confirm, ...exitConfirmModalProps } = useExitRoomConfirmModal(classroomStore);\n\n        const [isRealtimeSideOpen, openRealtimeSide] = useState(true);\n\n        useEffect(() => {\n            if (classroomStore.isCreator && classroomStore.roomStatus === RoomStatus.Idle) {\n                void classroomStore.startClass();\n            }\n        }, [classroomStore]);\n\n        return (\n            <div className=\"big-class-page-container\">\n                <div className=\"big-class-realtime-container\">\n                    <div className=\"big-class-realtime-box\">\n                        {windowsBtn ? (\n                            <TopBar\n                                left={renderTopBarLeft()}\n                                right={renderTopBarRight()}\n                                showWindowsSystemBtn={windowsBtn.showWindowsBtn}\n                                onClickWindowsSystemBtn={windowsBtn.onClickWindowsSystemBtn}\n                                onDoubleClick={windowsBtn.clickWindowMaximize}\n                            />\n                        ) : (\n                            <TopBar left={renderTopBarLeft()} right={renderTopBarRight()} />\n                        )}\n                        <div className=\"big-class-realtime-content\">\n                            <div className=\"big-class-realtime-content-container\">\n                                <ShareScreen classroomStore={classroomStore} />\n                                <ShareScreenPicker\n                                    classroomStore={classroomStore}\n                                    handleOk={() => classroomStore.toggleShareScreen(true)}\n                                />\n                                <Whiteboard\n                                    classRoomStore={classroomStore}\n                                    whiteboardStore={whiteboardStore}\n                                />\n                            </div>\n                            {renderRealtimePanel()}\n                        </div>\n                        <ExitRoomConfirm\n                            isCreator={classroomStore.isCreator}\n                            {...exitConfirmModalProps}\n                        />\n                        <RoomStatusStoppedModal\n                            isCreator={classroomStore.isCreator}\n                            isRemoteLogin={classroomStore.isRemoteLogin}\n                            roomStatus={classroomStore.roomStatus}\n                        />\n                    </div>\n                </div>\n            </div>\n        );\n\n        function renderTopBarLeft(): React.ReactNode {\n            return (\n                <>\n                    <ExtraPadding />\n                    <NetworkStatus networkQuality={classroomStore.networkQuality} />\n                    {classroomStore.isCreator ? (\n                        classroomStore.roomInfo?.beginTime && (\n                            <Timer\n                                beginTime={classroomStore.roomInfo.beginTime}\n                                roomStatus={classroomStore.roomStatus}\n                            />\n                        )\n                    ) : (\n                        <RoomInfo\n                            roomStatus={classroomStore.roomStatus}\n                            roomType={classroomStore.roomInfo?.roomType}\n                        />\n                    )}\n                </>\n            );\n        }\n\n        function renderTopBarRight(): React.ReactNode {\n            return (\n                <>\n                    {whiteboardStore.isWritable && !classroomStore.isRemoteScreenSharing && (\n                        <TopBarRightBtn\n                            icon={<SVGScreenSharing active={classroomStore.isScreenSharing} />}\n                            title={t(\"share-screen.self\")}\n                            onClick={() => {\n                                if (window.isElectron) {\n                                    if (classroomStore.isScreenSharing) {\n                                        classroomStore.toggleShareScreen(false);\n                                    } else {\n                                        classroomStore.toggleShareScreenPicker(true);\n                                    }\n                                } else {\n                                    classroomStore.toggleShareScreen();\n                                }\n                            }}\n                        />\n                    )}\n                    {classroomStore.isCreator && (\n                        <CloudRecordBtn\n                            isRecording={classroomStore.isRecording}\n                            loading={classroomStore.isRecordingLoading}\n                            onClick={() => {\n                                void classroomStore.toggleRecording({\n                                    onStop() {\n                                        void message.success(t(\"recording-completed-tips\"));\n                                    },\n                                });\n                            }}\n                        />\n                    )}\n                    {/* TODO: open cloud-storage sub window */}\n                    <CloudStorageButton classroom={classroomStore} />\n                    <InviteButton roomInfo={classroomStore.roomInfo} />\n                    {!windowsBtn?.showWindowsBtn && (\n                        <TopBarRightBtn\n                            icon={<SVGExit />}\n                            title={t(\"exit\")}\n                            onClick={() => confirm(ExitRoomConfirmType.ExitButton)}\n                        />\n                    )}\n                    {windowsBtn?.showWindowsBtn ? null : <TopBarDivider />}\n                    <TopBarRightBtn\n                        icon={isRealtimeSideOpen ? <SVGMenuUnfold /> : <SVGMenuFold />}\n                        title={isRealtimeSideOpen ? t(\"side-panel.hide\") : t(\"side-panel.show\")}\n                        onClick={handleSideOpenerSwitch}\n                    />\n                    {windowsBtn?.showWindowsBtn && <TopBarDivider />}\n                </>\n            );\n        }\n\n        function renderRealtimePanel(): React.ReactNode {\n            const { creator } = classroomStore.users;\n\n            return (\n                <RealtimePanel\n                    chatSlot={\n                        <ChatPanel classRoomStore={classroomStore} maxSpeakingUsers={1}></ChatPanel>\n                    }\n                    isShow={isRealtimeSideOpen}\n                    isVideoOn={classroomStore.isJoinedRTC}\n                    videoSlot={\n                        <div className=\"big-class-realtime-rtc-box\">\n                            <RTCAvatar\n                                avatarUser={creator}\n                                isAvatarUserCreator={true}\n                                isCreator={classroomStore.isCreator}\n                                rtcAvatar={creator && classroomStore.rtc.getAvatar(creator.rtcUID)}\n                                updateDeviceState={classroomStore.updateDeviceState}\n                                userUUID={classroomStore.userUUID}\n                            />\n                            {classroomStore.onStageUserUUIDs.length > 0 && (\n                                <RTCAvatar\n                                    avatarUser={classroomStore.firstOnStageUser}\n                                    isAvatarUserCreator={false}\n                                    isCreator={classroomStore.isCreator}\n                                    rtcAvatar={\n                                        classroomStore.firstOnStageUser &&\n                                        classroomStore.rtc.getAvatar(\n                                            classroomStore.firstOnStageUser.rtcUID,\n                                        )\n                                    }\n                                    updateDeviceState={classroomStore.updateDeviceState}\n                                    userUUID={classroomStore.userUUID}\n                                />\n                            )}\n                        </div>\n                    }\n                />\n            );\n        }\n\n        function handleSideOpenerSwitch(): void {\n            openRealtimeSide(isRealtimeSideOpen => !isRealtimeSideOpen);\n            whiteboardStore.setRightSideClose(isRealtimeSideOpen);\n        }\n    }),\n);\n\nexport default BigClassPage;\n"],"names":["BigClassPage","withClassroomStore","observer","classroomStore","useLoginCheck","t","useTranslate","whiteboardStore","windowsBtn","useContext","WindowsSystemBtnContext","confirm","exitConfirmModalProps","useExitRoomConfirmModal","isRealtimeSideOpen","openRealtimeSide","useState","useEffect","isCreator","roomStatus","RoomStatus","Idle","startClass","_jsxDEV","TopBar","renderTopBarLeft","renderTopBarRight","showWindowsBtn","onClickWindowsSystemBtn","clickWindowMaximize","_jsxFileName","ShareScreen","ShareScreenPicker","toggleShareScreen","Whiteboard","renderRealtimePanel","ExitRoomConfirm","RoomStatusStoppedModal","isRemoteLogin","_Fragment","ExtraPadding","NetworkStatus","networkQuality","roomInfo","beginTime","Timer","RoomInfo","roomType","isWritable","isRemoteScreenSharing","TopBarRightBtn","SVGScreenSharing","isScreenSharing","window","isElectron","toggleShareScreenPicker","CloudRecordBtn","isRecording","isRecordingLoading","toggleRecording","onStop","message","success","CloudStorageButton","InviteButton","SVGExit","ExitRoomConfirmType","ExitButton","TopBarDivider","SVGMenuUnfold","SVGMenuFold","handleSideOpenerSwitch","creator","users","RealtimePanel","ChatPanel","isJoinedRTC","RTCAvatar","rtc","getAvatar","rtcUID","updateDeviceState","userUUID","onStageUserUUIDs","length","firstOnStageUser","setRightSideClose"],"mappings":"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"}