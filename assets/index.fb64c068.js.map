{"version":3,"file":"index.fb64c068.js","sources":["../../../../packages/flat-components/src/components/FilePreview/FilePreviewImage/index.tsx","../../../../packages/flat-components/src/components/FilePreview/FilePreviewAudio/index.tsx","../../../../packages/flat-components/src/components/FilePreview/FilePreviewVideo/index.tsx","../../../../packages/flat-pages/src/FilePreviewPage/index.tsx"],"sourcesContent":["import \"./style.less\";\nimport { CloudFile } from \"@netless/flat-server-api\";\nimport React, { FC } from \"react\";\n\nexport interface FilePreviewImageProps {\n    file: CloudFile;\n}\n\nexport const FilePreviewImage: FC<FilePreviewImageProps> = ({ file }) => {\n    return (\n        <div className=\"file-preview-image-container\">\n            <img alt={file.fileName} src={file.fileURL} />\n        </div>\n    );\n};\n","import \"./style.less\";\n\nimport { CloudFile } from \"@netless/flat-server-api\";\nimport React, { FC } from \"react\";\n\nexport interface FilePreviewAudioProps {\n    file: CloudFile;\n}\n\nexport const FilePreviewAudio: FC<FilePreviewAudioProps> = ({ file }) => {\n    return (\n        <div className=\"file-preview-audio-container\">\n            <audio controls src={file.fileURL} />\n        </div>\n    );\n};\n","import \"./style.less\";\n\nimport { CloudFile } from \"@netless/flat-server-api\";\nimport React, { FC } from \"react\";\n\nexport interface FilePreviewVideoProps {\n    file: CloudFile;\n}\n\nexport const FilePreviewVideo: FC<FilePreviewVideoProps> = ({ file }) => {\n    return (\n        <div className=\"file-preview-video-container\">\n            <video controls src={file.fileURL} />\n        </div>\n    );\n};\n","import React from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport {\n    ErrorPage,\n    useSafePromise,\n    FilePreviewImage,\n    FilePreviewAudio,\n    FilePreviewVideo,\n} from \"flat-components\";\nimport { RouteNameType, RouteParams } from \"../utils/routes\";\nimport { CloudFile } from \"@netless/flat-server-api\";\nimport { useIsomorphicLayoutEffect } from \"react-use\";\nimport { FlatServices, IServiceFileExtensions, IServiceFilePreview } from \"@netless/flat-services\";\n\nexport interface FilePreviewPageProps {\n    file?: CloudFile;\n}\n\nexport const FilePreviewPage: React.FC<FilePreviewPageProps> = props => {\n    const sp = useSafePromise();\n    const params = useParams<RouteParams<RouteNameType.FilePreviewPage>>();\n    const [containerNode, setContainerNode] = React.useState<HTMLDivElement | null>(null);\n    const [service, setService] = React.useState<IServiceFilePreview | null | undefined>();\n\n    const file = React.useMemo(() => {\n        if (props.file) {\n            return props.file;\n        }\n        try {\n            return JSON.parse(decodeURIComponent(params.file)) as CloudFile;\n        } catch {\n            return null;\n        }\n    }, [props.file, params]);\n\n    const fileExt = React.useMemo(\n        () =>\n            (/\\.([^.]+)$/.exec(file?.fileName || \"\") || [\n                \"\",\n                \"\",\n            ])[1].toLowerCase() as IServiceFileExtensions,\n        [file],\n    );\n\n    useIsomorphicLayoutEffect(() => {\n        let previewService: IServiceFilePreview | null = null;\n        sp(FlatServices.getInstance().requestService(`file-preview:${fileExt}`, false)).then(\n            service => {\n                previewService = service;\n                setService(service);\n            },\n        );\n        return () => {\n            previewService?.destroy?.();\n        };\n    }, []);\n\n    useIsomorphicLayoutEffect(() => {\n        if (file && containerNode && service) {\n            service.preview(file, containerNode);\n        }\n    }, [file, containerNode, service]);\n\n    if (!file) {\n        return <ErrorPage />;\n    }\n\n    return (\n        <div\n            ref={setContainerNode}\n            className=\"file-preview-container\"\n            style={{ height: \"100%\", overflow: \"hidden\" }}\n        >\n            {service === null && renderBuiltinFilePreview(file, fileExt)}\n        </div>\n    );\n};\n\nexport default FilePreviewPage;\n\nfunction renderBuiltinFilePreview(file: CloudFile, fileExt: string): React.ReactNode {\n    switch (fileExt) {\n        case \"jpg\":\n        case \"jpeg\":\n        case \"png\":\n        case \"webp\": {\n            return <FilePreviewImage file={file} />;\n        }\n        case \"mp3\": {\n            return <FilePreviewAudio file={file} />;\n        }\n        case \"mp4\": {\n            return <FilePreviewVideo file={file} />;\n        }\n    }\n    return <ErrorPage />;\n}\n"],"names":["FilePreviewImage","file","fileName","fileURL","_jsxFileName","FilePreviewAudio","FilePreviewVideo","FilePreviewPage","props","sp","useSafePromise","params","useParams","containerNode","setContainerNode","React","useState","service","setService","useMemo","JSON","parse","decodeURIComponent","fileExt","exec","toLowerCase","useIsomorphicLayoutEffect","previewService","FlatServices","getInstance","requestService","then","destroy","preview","height","overflow","renderBuiltinFilePreview","_jsxDEV","ErrorPage"],"mappings":"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"}