var Pe=Object.defineProperty;var Oe=(e,t,s)=>t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var w=(e,t,s)=>(Oe(e,typeof t!="symbol"?t+"":t,s),s);import{S as j,R as Fe,aW as A,a as $,aX as Be,V as z,aY as He,aZ as Ye,F as ae}from"./index.ec641b5a.js";import{q as je}from"./courseware-converting.24396c0e.js";const We=`.netless-app-docs-viewer-footer{box-sizing:border-box;height:26px;display:flex;align-items:center;padding:0 16px;border-top:1px solid #eeeef7;font-family:PingFang SC,Source Han Sans SC,Microsoft YaHei,Helvetica Neue,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif}.netless-app-docs-viewer-footer-btn{box-sizing:border-box;width:26px;height:26px;font-size:0;margin:0;padding:3px;border:none;border-radius:1px;outline:none;color:currentColor;background:transparent;transition:background .4s;cursor:pointer;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.netless-app-docs-viewer-footer-btn:hover{background:rgba(237,237,240,.9)}@media (hover: none){.netless-app-docs-viewer-footer-btn:hover{background:transparent!important}}.netless-app-docs-viewer-footer-btn>svg{width:100%;height:100%}.netless-app-docs-viewer-footer-btn>svg:nth-of-type(2){display:none}.netless-app-docs-viewer-footer-btn.netless-app-docs-viewer-footer-btn-playing>svg:nth-of-type(1){display:none}.netless-app-docs-viewer-footer-btn.netless-app-docs-viewer-footer-btn-playing>svg:nth-of-type(2){display:initial}.netless-app-docs-viewer-footer-btn~.netless-app-docs-viewer-footer-btn{margin-left:15px}.netless-app-docs-viewer-page-jumps{flex:1;display:flex;justify-content:center;align-items:center}.netless-app-docs-viewer-page-number{display:flex;align-items:center;height:26px;margin-left:auto;font-size:13px;white-space:nowrap;word-break:keep-all;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-page-number-input{border:none;outline:none;width:3em;margin:0;padding:0 .5em 0 2px;text-align:right;font-size:13px;line-height:1;font-weight:400;font-family:inherit;border-radius:2px;color:currentColor;font-family:PingFang SC,Source Han Sans SC,Microsoft YaHei,Helvetica Neue,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;background:transparent;transition:background .4s;-webkit-tap-highlight-color:rgba(0,0,0,0)}.netless-app-docs-viewer-page-number-input:hover,.netless-app-docs-viewer-page-number-input:focus,.netless-app-docs-viewer-page-number-input:active{user-select:text;background:#fff;box-shadow:#63636333 0 2px 8px}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-footer-btn{cursor:not-allowed}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-footer-btn:hover{background:transparent}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input{cursor:not-allowed}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:hover,.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:focus,.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:active{background:transparent;box-shadow:none}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:disabled{color:inherit}.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:active,.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:focus,.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:hover{color:currentColor;background:#25282e}.telebox-color-scheme-dark .netless-app-docs-viewer-footer{border-top:none}.telebox-color-scheme-dark .netless-app-docs-viewer-footer-btn:hover{background:#212126}.netless-app-docs-viewer-preview-mask{position:absolute;z-index:10200;top:0;left:0;width:100%;height:100%}.netless-app-docs-viewer-preview{box-sizing:border-box;display:flex;flex-direction:column;align-items:center;position:absolute;z-index:10300;top:0;left:0;width:33%;max-width:200px;height:100%;padding-top:10px;transform:translate(-100%);background:rgba(237,237,240,.9);box-shadow:inset -1px 0 #0000001c;transition:transform .4s;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-preview.netless-app-docs-viewer-preview-active{transform:translate(0)}.netless-app-docs-viewer-preview-page{position:relative;display:block;width:55%;margin-bottom:10px;font-size:0;color:transparent;outline:none;border:7px solid transparent;border-radius:4px;transition:border-color .3s;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-preview-page:hover,.netless-app-docs-viewer-preview-page.netless-app-docs-viewer-preview-page-active{border-color:#444e601a}.netless-app-docs-viewer-preview-page>img{width:100%;height:auto;box-sizing:border-box;border:1px solid rgba(0,0,0,.5);border-radius:1px;background-color:#fff;box-shadow:0 2px 8px #0000004d}.netless-app-docs-viewer-preview-page-name{position:absolute;top:1px;left:-10px;transform:translate(-100%);text-align:right;font-size:12px;color:#5f5f5f;user-select:none}.telebox-color-scheme-dark .netless-app-docs-viewer-preview{background:rgba(50,50,50,.9)}.netless-app-docs-viewer-content{position:relative;height:100%;overflow:hidden}.netless-app-docs-viewer-static-scrollbar{box-sizing:border-box;position:absolute;top:0;right:0;z-index:2147483647;width:16px;min-height:30px;margin:0;padding:0 0 0 8px;border:none;outline:none;opacity:0;background:transparent;transition:opacity .4s 3s,transform .1s;user-select:none;touch-action:none}.netless-app-docs-viewer-static-scrollbar:after{content:"";display:block;width:8px;height:100%;border-radius:4px;background:rgba(68,78,96,.4);box-shadow:1px 1px 8px #ffffffb3;transition:background .4s}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrolling{opacity:1;transition:opacity .4s,transform .1s}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrollbar-dragging{opacity:1;transition:opacity .4s 3s!important}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrollbar-dragging:after{background:rgba(68,78,96,.6)}.netless-app-docs-viewer-static-scrollbar:hover:after,.netless-app-docs-viewer-static-scrollbar:focus:after{background:rgba(68,78,96,.5)}.netless-app-docs-viewer-static-scrollbar:active:after{background:rgba(68,78,96,.6)}.telebox-body-wrap:hover .netless-app-docs-viewer-static-scrollbar{opacity:1;transition:opacity .4s,transform .1s}.telebox-readonly .netless-app-docs-viewer-static-scrollbar{display:none}.page-renderer-pages-container{position:relative;width:100%;height:100%}.page-renderer-page{position:absolute;top:0;left:0;background-position:center;background-size:cover;background-repeat:no-repeat}.page-renderer-pages-container.is-hwa .page-renderer-page{will-change:transform}.page-renderer-page-img{display:block;width:100%;height:auto;user-select:none}.netless-app-docs-viewer-static-pages{overflow:hidden;position:relative;height:100%;user-select:none}.netless-app-docs-viewer-static-page{display:block;width:100%;height:auto;user-select:none}.netless-app-docs-viewer-dynamic-wb-view{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100;overflow:hidden}.netless-app-docs-viewer-dynamic-wb-view .cursor-clicker .ppt-event-source{cursor:pointer}.file-preview-netless-container{width:100%;height:100%;display:flex;flex-direction:column;overflow:hidden}.file-preview-netless-body{position:relative;flex:1;overflow:hidden}.file-preview-netless-operate{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100}.file-preview-netless-footer{height:26px;overflow:hidden}
`,_=typeof window<"u",de=_&&!("onscroll"in window)||typeof navigator<"u"&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),pe=_&&"IntersectionObserver"in window,he=_&&"classList"in document.createElement("p"),ue=_&&window.devicePixelRatio>1,qe={elements_selector:".lazy",container:de||_?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_bg_set:"bg-set",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",class_entered:"entered",class_exited:"exited",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1,restore_on_error:!1},ge=e=>Object.assign({},qe,e),ie=function(e,t){let s;const r="LazyLoad::Initialized",i=new e(t);try{s=new CustomEvent(r,{detail:{instance:i}})}catch{s=document.createEvent("CustomEvent"),s.initCustomEvent(r,!1,!1,{instance:i})}window.dispatchEvent(s)},Ue=(e,t)=>{if(!!t)if(!t.length)ie(e,t);else for(let s=0,r;r=t[s];s+=1)ie(e,r)},y="src",W="srcset",q="sizes",fe="poster",R="llOriginalAttrs",ve="data",U="loading",we="loaded",be="applied",Ge="entered",G="error",me="native",ye="data-",Ee="ll-status",v=(e,t)=>e.getAttribute(ye+t),Je=(e,t,s)=>{var r=ye+t;if(s===null){e.removeAttribute(r);return}e.setAttribute(r,s)},V=e=>v(e,Ee),k=(e,t)=>Je(e,Ee,t),O=e=>k(e,null),J=e=>V(e)===null,Ke=e=>V(e)===U,Qe=e=>V(e)===G,K=e=>V(e)===me,Ze=[U,we,be,G],Xe=e=>Ze.indexOf(V(e))>=0,S=(e,t,s,r)=>{if(!!e){if(r!==void 0){e(t,s,r);return}if(s!==void 0){e(t,s);return}e(t)}},L=(e,t)=>{if(he){e.classList.add(t);return}e.className+=(e.className?" ":"")+t},m=(e,t)=>{if(he){e.classList.remove(t);return}e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},et=e=>{e.llTempImage=document.createElement("IMG")},tt=e=>{delete e.llTempImage},$e=e=>e.llTempImage,F=(e,t)=>{if(!t)return;const s=t._observer;!s||s.unobserve(e)},st=e=>{e.disconnect()},rt=(e,t,s)=>{t.unobserve_entered&&F(e,s)},Q=(e,t)=>{!e||(e.loadingCount+=t)},at=e=>{!e||(e.toLoadCount-=1)},xe=(e,t)=>{!e||(e.toLoadCount=t)},it=e=>e.loadingCount>0,ot=e=>e.toLoadCount>0,_e=e=>{let t=[];for(let s=0,r;r=e.children[s];s+=1)r.tagName==="SOURCE"&&t.push(r);return t},Z=(e,t)=>{const s=e.parentNode;if(!s||s.tagName!=="PICTURE")return;_e(s).forEach(t)},Se=(e,t)=>{_e(e).forEach(t)},B=[y],Ce=[y,fe],M=[y,W,q],ke=[ve],H=e=>!!e[R],Ne=e=>e[R],Le=e=>delete e[R],N=(e,t)=>{if(H(e))return;const s={};t.forEach(r=>{s[r]=e.getAttribute(r)}),e[R]=s},nt=e=>{H(e)||(e[R]={backgroundImage:e.style.backgroundImage})},ct=(e,t,s)=>{if(!s){e.removeAttribute(t);return}e.setAttribute(t,s)},C=(e,t)=>{if(!H(e))return;const s=Ne(e);t.forEach(r=>{ct(e,r,s[r])})},lt=e=>{if(!H(e))return;const t=Ne(e);e.style.backgroundImage=t.backgroundImage},Ie=(e,t,s)=>{L(e,t.class_applied),k(e,be),s&&(t.unobserve_completed&&F(e,t),S(t.callback_applied,e,s))},Te=(e,t,s)=>{L(e,t.class_loading),k(e,U),s&&(Q(s,1),S(t.callback_loading,e,s))},x=(e,t,s)=>{!s||e.setAttribute(t,s)},oe=(e,t)=>{x(e,q,v(e,t.data_sizes)),x(e,W,v(e,t.data_srcset)),x(e,y,v(e,t.data_src))},dt=(e,t)=>{Z(e,s=>{N(s,M),oe(s,t)}),N(e,M),oe(e,t)},pt=(e,t)=>{N(e,B),x(e,y,v(e,t.data_src))},ht=(e,t)=>{Se(e,s=>{N(s,B),x(s,y,v(s,t.data_src))}),N(e,Ce),x(e,fe,v(e,t.data_poster)),x(e,y,v(e,t.data_src)),e.load()},ut=(e,t)=>{N(e,ke),x(e,ve,v(e,t.data_src))},gt=(e,t,s)=>{const r=v(e,t.data_bg),i=v(e,t.data_bg_hidpi),o=ue&&i?i:r;!o||(e.style.backgroundImage=`url("${o}")`,$e(e).setAttribute(y,o),Te(e,t,s))},ft=(e,t,s)=>{const r=v(e,t.data_bg_multi),i=v(e,t.data_bg_multi_hidpi),o=ue&&i?i:r;!o||(e.style.backgroundImage=o,Ie(e,t,s))},vt=(e,t,s)=>{const r=v(e,t.data_bg_set);if(!r)return;const i=r.split("|");let o=i.map(n=>`image-set(${n})`);e.style.backgroundImage=o.join(),e.style.backgroundImage===""&&(o=i.map(n=>`-webkit-image-set(${n})`),e.style.backgroundImage=o.join()),Ie(e,t,s)},Ae={IMG:dt,IFRAME:pt,VIDEO:ht,OBJECT:ut},wt=(e,t)=>{const s=Ae[e.tagName];!s||s(e,t)},bt=(e,t,s)=>{const r=Ae[e.tagName];!r||(r(e,t),Te(e,t,s))},mt=["IMG","IFRAME","VIDEO","OBJECT"],yt=e=>mt.indexOf(e.tagName)>-1,ze=(e,t)=>{t&&!it(t)&&!ot(t)&&S(e.callback_finish,t)},ne=(e,t,s)=>{e.addEventListener(t,s),e.llEvLisnrs[t]=s},Et=(e,t,s)=>{e.removeEventListener(t,s)},X=e=>!!e.llEvLisnrs,$t=(e,t,s)=>{X(e)||(e.llEvLisnrs={});const r=e.tagName==="VIDEO"?"loadeddata":"load";ne(e,r,t),ne(e,"error",s)},Y=e=>{if(!X(e))return;const t=e.llEvLisnrs;for(let s in t){const r=t[s];Et(e,s,r)}delete e.llEvLisnrs},Me=(e,t,s)=>{tt(e),Q(s,-1),at(s),m(e,t.class_loading),t.unobserve_completed&&F(e,s)},xt=(e,t,s,r)=>{const i=K(t);Me(t,s,r),L(t,s.class_loaded),k(t,we),S(s.callback_loaded,t,r),i||ze(s,r)},_t=(e,t,s,r)=>{const i=K(t);Me(t,s,r),L(t,s.class_error),k(t,G),S(s.callback_error,t,r),s.restore_on_error&&C(t,M),i||ze(s,r)},ee=(e,t,s)=>{const r=$e(e)||e;if(X(r))return;$t(r,n=>{xt(n,e,t,s),Y(r)},n=>{_t(n,e,t,s),Y(r)})},St=(e,t,s)=>{et(e),ee(e,t,s),nt(e),gt(e,t,s),ft(e,t,s),vt(e,t,s)},Ct=(e,t,s)=>{ee(e,t,s),bt(e,t,s)},te=(e,t,s)=>{yt(e)?Ct(e,t,s):St(e,t,s)},kt=(e,t,s)=>{e.setAttribute("loading","lazy"),ee(e,t,s),wt(e,t),k(e,me)},ce=e=>{e.removeAttribute(y),e.removeAttribute(W),e.removeAttribute(q)},Nt=e=>{Z(e,t=>{ce(t)}),ce(e)},Re=e=>{Z(e,t=>{C(t,M)}),C(e,M)},Lt=e=>{Se(e,t=>{C(t,B)}),C(e,Ce),e.load()},It=e=>{C(e,B)},Tt=e=>{C(e,ke)},At={IMG:Re,IFRAME:It,VIDEO:Lt,OBJECT:Tt},zt=e=>{const t=At[e.tagName];if(!t){lt(e);return}t(e)},Mt=(e,t)=>{J(e)||K(e)||(m(e,t.class_entered),m(e,t.class_exited),m(e,t.class_applied),m(e,t.class_loading),m(e,t.class_loaded),m(e,t.class_error))},Rt=(e,t)=>{zt(e),Mt(e,t),O(e),Le(e)},Vt=(e,t,s,r)=>{!s.cancel_on_exit||!Ke(e)||e.tagName==="IMG"&&(Y(e),Nt(e),Re(e),m(e,s.class_loading),Q(r,-1),O(e),S(s.callback_cancel,e,t,r))},Dt=(e,t,s,r)=>{const i=Xe(e);k(e,Ge),L(e,s.class_entered),m(e,s.class_exited),rt(e,s,r),S(s.callback_enter,e,t,r),!i&&te(e,s,r)},Pt=(e,t,s,r)=>{J(e)||(L(e,s.class_exited),Vt(e,t,s,r),S(s.callback_exit,e,t,r))},Ot=["IMG","IFRAME","VIDEO"],Ve=e=>e.use_native&&"loading"in HTMLImageElement.prototype,Ft=(e,t,s)=>{e.forEach(r=>{Ot.indexOf(r.tagName)!==-1&&kt(r,t,s)}),xe(s,0)},Bt=e=>e.isIntersecting||e.intersectionRatio>0,Ht=e=>({root:e.container===document?null:e.container,rootMargin:e.thresholds||e.threshold+"px"}),Yt=(e,t,s)=>{e.forEach(r=>Bt(r)?Dt(r.target,r,t,s):Pt(r.target,r,t,s))},jt=(e,t)=>{t.forEach(s=>{e.observe(s)})},Wt=(e,t)=>{st(e),jt(e,t)},qt=(e,t)=>{!pe||Ve(e)||(t._observer=new IntersectionObserver(s=>{Yt(s,e,t)},Ht(e)))},De=e=>Array.prototype.slice.call(e),P=e=>e.container.querySelectorAll(e.elements_selector),Ut=e=>De(e).filter(J),Gt=e=>Qe(e),Jt=e=>De(e).filter(Gt),le=(e,t)=>Ut(e||P(t)),Kt=(e,t)=>{Jt(P(e)).forEach(r=>{m(r,e.class_error),O(r)}),t.update()},Qt=(e,t)=>{!_||(t._onlineHandler=()=>{Kt(e,t)},window.addEventListener("online",t._onlineHandler))},Zt=e=>{!_||window.removeEventListener("online",e._onlineHandler)},D=function(e,t){const s=ge(e);this._settings=s,this.loadingCount=0,qt(s,this),Qt(s,this),this.update(t)};D.prototype={update:function(e){const t=this._settings,s=le(e,t);if(xe(this,s.length),de||!pe){this.loadAll(s);return}if(Ve(t)){Ft(s,t,this);return}Wt(this._observer,s)},destroy:function(){this._observer&&this._observer.disconnect(),Zt(this),P(this._settings).forEach(e=>{Le(e)}),delete this._observer,delete this._settings,delete this._onlineHandler,delete this.loadingCount,delete this.toLoadCount},loadAll:function(e){const t=this._settings;le(e,t).forEach(r=>{F(r,this),te(r,t,this)})},restoreAll:function(){const e=this._settings;P(e).forEach(t=>{Rt(t,e)})}};D.load=(e,t)=>{const s=ge(t);te(e,s)};D.resetStatus=e=>{O(e)};_&&Ue(D,window.lazyLoadOptions);class Xt{constructor({namespace:t,pages$:s,sideEffect:r,readonly$:i,events:o,wrapClassName:n,root:c,pagesIndex$:u}){this.showPreview$=new z(!1),this.namespace=t,this.pages$=s,this.sideEffect=r,this.readonly$=i,this.events=o,this.wrapClassName=n,this.sideEffect.addDisposer(this.events.on("togglePreview",()=>{this.showPreview$.setValue(!this.showPreview$.value)})),this.sideEffect.addDisposer(this.showPreview$.subscribe(d=>{this.sideEffect.add(()=>{const a=this.renderPreview(),g=this.renderPreviewMask();if(d){c.appendChild(a),c.appendChild(g),a.scrollTop;const p=a.querySelector("."+this.wrapClassName(`preview-page-${u.value}`));return p&&a.scrollTo({top:p.offsetTop-16}),a.classList.toggle(this.wrapClassName("preview-active"),!0),this.previewLazyLoad=new D({container:this.$preview,elements_selector:"."+this.wrapClassName("preview-page>img")}),()=>{var l;return(l=this.previewLazyLoad)==null?void 0:l.destroy()}}else return a.classList.toggle(this.wrapClassName("preview-active"),!1),this.sideEffect.setTimeout(()=>{a.remove(),g.remove()},500,"preview-remove"),null},"preview-lazyload")}))}destroy(){var t,s;(t=this.$preview)==null||t.remove(),(s=this.$previewMask)==null||s.remove()}renderPreview(){if(this.$preview)return this.$preview;const t=document.createElement("div");return t.className=this.wrapClassName("preview")+" tele-fancy-scrollbar",this.$preview=t,this.sideEffect.addEventListener(t,"wheel",s=>s.stopPropagation(),{passive:!1}),this.sideEffect.addDisposer(this.pages$.subscribe(s=>{var r;this.sideEffect.add(()=>{const i=s.map((o,n)=>{var c;const u=(c=o.thumbnail)!=null?c:o.src.startsWith("ppt")?void 0:o.src;if(!u)return;const d=String(n),a=document.createElement("a");a.className=this.wrapClassName("preview-page")+" "+this.wrapClassName(`preview-page-${n}`),a.setAttribute("href","#"),a.dataset.pageIndex=d;const g=document.createElement("span");g.className=this.wrapClassName("preview-page-name"),g.textContent=String(n+1),g.dataset.pageIndex=d;const p=document.createElement("img");return p.width=o.width,p.height=o.height,p.dataset.src=u,p.dataset.pageIndex=d,a.appendChild(p),a.appendChild(g),t.appendChild(a),a});return()=>i.forEach(o=>o==null?void 0:o.remove())},"render-preview-pages"),(r=this.previewLazyLoad)==null||r.update()})),this.sideEffect.addEventListener(t,"click",s=>{var r;if(this.readonly$.value)return;const i=(r=s.target.dataset)==null?void 0:r.pageIndex;i&&(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),this.events.emit("jumpPage",Number(i)),this.showPreview$.setValue(!1))}),t}renderPreviewMask(){if(this.$previewMask)return this.$previewMask;const t=document.createElement("div");return t.className=this.wrapClassName("preview-mask"),this.$previewMask=t,this.sideEffect.addEventListener(t,"click",s=>{this.readonly$.value||s.target===t&&this.showPreview$.setValue(!1)}),t}}function es(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-sidebar`),s.setAttribute("viewBox","0 0 64 64");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M50 8H14c-3.309 0-6 2.691-6 6v36c0 3.309 2.691 6 6 6h36c3.309 0 6-2.691 6-6V14c0-3.309-2.691-6-6-6zM12 50V14c0-1.103.897-2 2-2h8v40h-8c-1.103 0-2-.897-2-2zm40 0c0 1.103-.897 2-2 2H26V12h24c1.103 0 2 .897 2 2z"),s.appendChild(r),s}function ts(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-arrow-left`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M177.81 249.959L337.473 90.295c2.722-2.865 2.651-7.378-.143-10.1-2.793-2.65-7.163-2.65-9.956 0l-164.75 164.75c-2.793 2.793-2.793 7.306 0 10.1l164.75 164.75c2.865 2.722 7.378 2.65 10.099-.143 2.651-2.794 2.651-7.163 0-9.957L177.809 249.959z"),s.appendChild(r),s}function ss(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-arrow-right`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M322.19 250.041L162.527 409.705c-2.722 2.865-2.651 7.378.143 10.1 2.793 2.65 7.163 2.65 9.956 0l164.75-164.75c2.793-2.793 2.793-7.306 0-10.1l-164.75-164.75c-2.865-2.722-7.378-2.65-10.099.143-2.651 2.794-2.651 7.163 0 9.957l159.664 159.736z"),s.appendChild(r),s}function rs(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-play`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M418.158 257.419L174.663 413.33c-6.017 3.919-15.708 3.772-21.291-.29-2.791-2.018-4.295-4.483-4.295-7.084V94.109c0-5.65 6.883-10.289 15.271-10.289 4.298 0 8.391 1.307 11.181 3.332l242.629 155.484c6.016 3.917 6.451 10.292.649 14.491-.216.154-.432.154-.649.292zM170.621 391.288l223.116-141.301L170.71 107.753l-.089 283.535z"),s.appendChild(r),s}function as(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-pause`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M312.491 78.261c0-6.159 4.893-11.213 11.04-11.213 6.158 0 11.211 5.054 11.211 11.213v343.478c0 6.159-5.053 11.213-11.211 11.213-6.147 0-11.04-5.054-11.04-11.213V78.261zM165.257 78.261c0-6.159 4.893-11.213 11.04-11.213 6.158 0 11.211 5.054 11.211 11.213v343.478c0 6.159-5.053 11.213-11.211 11.213-6.147 0-11.04-5.054-11.04-11.213V78.261z"),s.appendChild(r),s}class is{constructor({namespace:t,pages$:s,sideEffect:r,readonly$:i,events:o,playable:n,wrapClassName:c,pagesIndex$:u,root:d}){this.namespace=t,this.pages$=s,this.sideEffect=r,this.readonly$=i,this.events=o,this.wrapClassName=c,this.pagesIndex$=u,this.playable=n,this.$footer=this.render(),d.appendChild(this.$footer)}destroy(){this.$footer.remove()}render(){const t=document.createElement("div");t.className=this.wrapClassName("footer"),this.sideEffect.addDisposer(this.readonly$.subscribe(d=>t.classList.toggle(this.wrapClassName("readonly"),d)));const s=this.renderFooterBtn("btn-sidebar",es(this.namespace));this.sideEffect.addEventListener(s,"click",()=>{this.readonly$.value||this.events.emit("togglePreview")}),t.appendChild(s),this.sideEffect.addDisposer(this.pages$.subscribe(d=>{const a=d.some(g=>g.thumbnail||!g.src.startsWith("ppt"));s.style.display=a?"":"none"}));const r=document.createElement("div");r.className=this.wrapClassName("page-jumps");const i=this.renderFooterBtn("btn-page-back",ts(this.namespace));if(this.sideEffect.addEventListener(i,"click",()=>{this.readonly$.value||this.events.emit("back")}),r.appendChild(i),this.playable){const d=this.renderFooterBtn("btn-page-play",rs(this.namespace),as(this.namespace));this.sideEffect.addEventListener(d,"click",()=>{this.readonly$.value||(d.classList.toggle(this.wrapClassName("footer-btn-playing"),!0),this.events.emit("play"),this.sideEffect.setTimeout(()=>d.classList.toggle(this.wrapClassName("footer-btn-playing"),!1),500,"returnPlay"))}),r.appendChild(d)}const o=this.renderFooterBtn("btn-page-next",ss(this.namespace));this.sideEffect.addEventListener(o,"click",()=>{this.readonly$.value||this.events.emit("next")}),r.appendChild(o);const n=document.createElement("div");n.className=this.wrapClassName("page-number");const c=document.createElement("input");c.className=this.wrapClassName("page-number-input"),this.sideEffect.addDisposer(this.readonly$.subscribe(d=>c.disabled=d)),this.sideEffect.addDisposer(this.pagesIndex$.subscribe(d=>c.value=String(d+1))),this.sideEffect.addEventListener(c,"blur",()=>{c.value=String(this.pagesIndex$.value+1)}),this.sideEffect.addEventListener(c,"change",()=>{if(this.readonly$.value)return;const d=c.value?Number(c.value)-1:NaN;d>=0?this.events.emit("jumpPage",d):c.value=String(this.pagesIndex$.value+1)});const u=document.createElement("span");return this.sideEffect.addDisposer(this.pages$.subscribe(d=>{u.textContent=" / "+d.length})),n.appendChild(c),n.appendChild(u),t.appendChild(r),t.appendChild(n),t}renderFooterBtn(t,s,r){const i=document.createElement("button");return i.className=this.wrapClassName("footer-btn")+" "+this.wrapClassName(t),i.appendChild(s),r&&i.appendChild(r),i}}class os{constructor({readonly$:t,pagesIndex$:s,previewRoot:r,footerRoot:i,pages$:o,playable:n}){this.wrapClassName=c=>`${this.namespace}-${c}`,this.namespace="netless-app-docs-viewer",this.sideEffect=new j,this.events=new Fe,this.preview=new Xt({pages$:o,readonly$:t,pagesIndex$:s,root:r,sideEffect:this.sideEffect,events:this.events,namespace:this.namespace,wrapClassName:this.wrapClassName}),this.footer=new is({pages$:o,readonly$:t,playable:n,pagesIndex$:s,root:i,namespace:this.namespace,sideEffect:this.sideEffect,events:this.events,wrapClassName:this.wrapClassName})}destroy(){this.preview.destroy(),this.footer.destroy(),this.sideEffect.flushAll(),this.events.destroy()}}function ns(e,t,s){return Math.min(Math.max(e,t),s)}class cs{constructor(t){var s,r,i;this.velocity=0,this._paused=!0,this._animationFrameID=null,this._loopTimestamp=0,this.looper=o=>{var n;if(this._paused)return;let c=Math.floor((o-this._loopTimestamp)/1e3*60)+1;for(this._loopTimestamp=o;c-- >0;)this.stepper();(n=this.onStep)==null||n.call(this,this.current),this._paused?this._animationFrameID=null:this._animationFrameID=window.requestAnimationFrame(this.looper)},this.current=(s=t.start)!=null?s:0,this.target=this.current,this.stiffness=(r=t.stiffness)!=null?r:170,this.damping=(i=t.damping)!=null?i:26,this.onStep=t.onStep}get paused(){return this._paused}stepTo(t,s){var r;this._paused&&s!=null&&(this.current=s),this._paused=!1,this.target=t,(r=this.onStep)==null||r.call(this,this.current),this._loopTimestamp=Date.now(),this._animationFrameID=window.requestAnimationFrame(this.looper)}pause(){this._paused=!0,this._animationFrameID!=null&&window.cancelAnimationFrame(this._animationFrameID)}destroy(){this.pause(),this.onStep=void 0}stepper(){const t=-this.stiffness*(this.current-this.target),s=-this.damping*this.velocity,r=this.velocity+(t+s)/60,i=this.current+r/60;Math.abs(r-0)<.01&&Math.abs(i-this.target)<.01?(this.current=this.target,this.velocity=0,this._paused=!0):(this.current=i,this.velocity=r)}}class ls{constructor(t,s,r,i,o,n){this.index=t,this.lastVisit=Date.now(),this.sideEffect=new j;const c=A(s,p=>p[t]||{width:0,height:0}),u=$([c,r],([p,l])=>(l.width-p.width)/2),d=$([o,n],([p,l])=>(p[t]||0)-l),a=document.createElement("div");a.className="page-renderer-page",a.dataset.index=`${t}`;const g=document.createElement("img");g.className="page-renderer-page-img",a.appendChild(g),this.sideEffect.addDisposer([$([c,i]).subscribe(([p,l])=>{a.style.width=`${p.width*l}px`,a.style.height=`${p.height*l}px`}),c.subscribe(p=>{p.thumbnail&&(a.style.backgroundImage=`url("${p.thumbnail}")`),g.width=p.width,g.height=p.height,g.src=p.src}),$([u,d,i]).subscribe(([p,l,h])=>{a.style.transform=`translate(${p*h}px, ${l*h}px)`})]),this.$page=a}destroy(){this.sideEffect.flushAll(),this.$page.remove()}}class ds{constructor(t,s,r,i,o){this.pages$=t,this.pagesSize$=s,this.scale$=r,this.pagesYs$=i,this.pagesScrollTop$=o,this.els=new Map,this.maxElCount=200,this.gcTimer=null,this.gc=()=>{var n;if(this.gcTimer=null,this.els.size>this.maxElCount){const c=[...this.els.values()].sort((u,d)=>d.lastVisit-u.lastVisit);for(let u=Math.floor(this.maxElCount/4);u<c.length;u++)(n=this.els.get(c[u].index))==null||n.destroy(),this.els.delete(c[u].index)}},this.schedule=window.requestIdleCallback||(n=>window.setTimeout(n,5e3)),this.cancelSchedule=window.cancelIdleCallback||window.clearTimeout}getEl(t){let s=this.els.get(t);return s||(s=new ls(t,this.pages$,this.pagesSize$,this.scale$,this.pagesYs$,this.pagesScrollTop$),this.els.set(t,s)),s.lastVisit=Date.now(),this.els.size>this.maxElCount&&this.gcTimer===null&&(this.gcTimer=this.schedule(this.gc)),s}destroy(){this.els.forEach(t=>t.destroy()),this.els.clear(),this.gcTimer!==null&&(this.cancelSchedule(this.gcTimer),this.gcTimer=null)}}class ps{constructor({pagesScrollTop$:t,containerRect$:s,pages$:r,pagesSize$:i}){this.sideEffect=new j,r=A(r,l=>l.map(h=>{if(h.thumbnail)return h;try{const f=new URL(h.src);return f.searchParams.set("x-oss-process","image/resize,l_50"),{...h,thumbnail:f.toString()}}catch(f){return console.error(f),h}}));const o=A(r,l=>{const h=Array(l.length);for(let f=0;f<l.length;f++)h[f]=f>0?h[f-1]+l[f-1].height:0;return h}),n=A(r,l=>{let h=1/0;for(let f=l.length-1;f>=0;f--)l[f].height<=h&&(h=l[f].height);return h}),c=$([t,o,r],([l,h,f])=>{if(h.length!==f.length)return c.value;for(let b=0;b<h.length;b++)if(h[b]+f[b].height-l>=.001)return b;return h.length-1}),u=$([s,i],([l,h])=>l.width/h.width||1),d=$([r,s,n,u],([l,h,f,b])=>ns(Math.ceil(h.height/b/f/2),1,l.length));Be(this,{pagesScrollTop:t,containerRect:s,pages:r,pagesSize:i,pagesIndex:c,pagesYs:o,pagesMinHeight:n,scale:u}),this.pageElManager=new ds(r,i,u,o,t),this.$pages=this.renderPages();const a=new z(!1);this.sideEffect.addDisposer(a.subscribe(l=>this.$pages.classList.toggle("is-hwa",l)));const g=()=>a.setValue(!1),p=()=>{this.sideEffect.setTimeout(g,1e3,"turn-off-hwa"),a.setValue(!0)};this.sideEffect.addDisposer($([c,d,r]).subscribe(([l,h,f])=>{p();const b=Math.max(l-h,0),se=Math.min(l+h,f.length-1);for(let E=0;E<this.$pages.children.length;E++){const I=this.$pages.children[E],re=Number(I.dataset.index);re>=b&&re<=se||(I.remove(),E--)}for(let E=b;E<=se;E++){const I=this.pageElManager.getEl(E);I.$page.parentElement!==this.$pages&&this.$pages.appendChild(I.$page)}}))}renderPages(){const t=document.createElement("div");return t.className="page-renderer-pages-container",this.sideEffect.addDisposer(this._containerRect$.subscribe(s=>{t.style.width=`${s.width}px`,t.style.height=`${s.height}px`}),"render-pages-size"),t}destroy(){this.sideEffect.flushAll(),this.$pages.remove(),this.pageElManager.destroy()}}function hs(e,t){return e.width===t.width&&e.height===t.height}function us(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function T(e,t,s){return Math.min(Math.max(e,t),s)}class gs{constructor(){w(this,"disposable",new He);w(this,"pagesScrollTop$");w(this,"pages$");w(this,"pagesSize$");w(this,"readonly$");w(this,"pageRenderer");w(this,"viewer");w(this,"stepper");w(this,"$docsViewer");this.readonly$=new z(!1),this.pages$=new z([]),this.pagesScrollTop$=new z(0),this.pagesSize$=A(this.pages$,a=>{let g=0,p=0;for(let l=a.length-1;l>=0;l--){const h=a[l];h.width>g&&(g=h.width),p+=h.height}return{width:Math.max(1,g),height:Math.max(1,p)}},{compare:hs});const t=document.createElement("div");this.$docsViewer=t,t.tabIndex=0,t.className="file-preview-netless-container";const s=document.createElement("style");s.textContent=We,t.appendChild(s);const r=document.createElement("div");r.className="file-preview-netless-body",t.appendChild(r);const i=document.createElement("div");i.className="file-preview-netless-operate",r.appendChild(i);const o=document.createElement("div");o.className="file-preview-netless-footer",t.appendChild(o);const n=()=>{const a=r.getBoundingClientRect();return{x:a.x,y:a.y,width:a.width,height:a.height}},c=new Ye(n(),{beforeSubscribe:a=>{let g=0;function p(){g=requestAnimationFrame(p),a(n())}return p(),()=>cancelAnimationFrame(g)},compare:us});this.pageRenderer=new ps({pagesScrollTop$:this.pagesScrollTop$,containerRect$:c,pages$:this.pages$,pagesSize$:this.pagesSize$}),r.appendChild(this.pageRenderer.$pages),this.viewer=new os({readonly$:this.readonly$,pagesIndex$:this.pageRenderer._pagesIndex$,previewRoot:r,footerRoot:o,pages$:this.pages$,playable:!1}),this.stepper=new cs({start:this.pagesScrollTop$.value,onStep:a=>{this.pagesScrollTop$.setValue(a)}}),this.disposable.push([this.viewer.events.on("jumpPage",a=>this.userScrollToPageIndex(a)),this.viewer.events.on("next",()=>{this.userScrollByPercent(.8)}),this.viewer.events.on("back",()=>{this.userScrollByPercent(-.8)})]),this.disposable.addEventListener(i,"wheel",a=>{!this.readonly$.value&&this.stepper.paused&&(a.stopPropagation(),a.preventDefault(),this.pagesScrollTop$.setValue(T(this.pagesScrollTop$.value+a.deltaY,0,this.pagesSize$.value.height-c.value.height/this.pageRenderer._scale$.value)))},{passive:!1});let u=NaN;this.disposable.addEventListener(i,"touchstart",a=>{a.stopPropagation(),a.preventDefault(),!this.readonly$.value&&a.touches.length>0&&this.stepper.paused&&(u=a.touches[0].pageY)},{passive:!1,capture:!0}),this.disposable.addEventListener(i,"touchmove",a=>{if(a.stopPropagation(),a.preventDefault(),!this.readonly$.value&&a.touches.length>0&&this.stepper.paused&&!Number.isNaN(u)){const g=u-a.touches[0].pageY;u=a.touches[0].pageY,this.pagesScrollTop$.setValue(T(this.pagesScrollTop$.value+g*3,0,this.pagesSize$.value.height-c.value.height/this.pageRenderer._scale$.value))}},{passive:!1,capture:!0});const d=a=>{a.stopPropagation(),a.preventDefault(),u=NaN};this.disposable.addEventListener(i,"touchend",d,{passive:!1,capture:!0}),this.disposable.addEventListener(i,"touchcancel",d,{passive:!1,capture:!0}),this.disposable.addEventListener(window,"keyup",a=>{if(!this.readonly$.value)switch(a.key){case"PageDown":{this.userScrollByPercent(.8);break}case"PageUp":{this.userScrollByPercent(-.8);break}case"ArrowLeft":{this.userScrollByPercent(-.25);break}case"ArrowRight":{this.userScrollByPercent(.25);break}case"ArrowDown":{this.userScrollByPercent(.5);break}case"ArrowUp":{this.userScrollByPercent(-.5);break}}})}userScrollToPageIndex(t){if(t=T(t,0,this.pages$.value.length-1),!this.readonly$.value&&!Number.isNaN(t)){const s=this.pageRenderer.pagesYs[t];s>=0&&this.stepper.stepTo(s+5/this.pageRenderer.scale)}}userScrollByPercent(t){this.readonly$.value||this.stepper.stepTo(T(this.pageRenderer.pagesScrollTop+this.pageRenderer.containerRect.height/this.pageRenderer.scale*T(t,-1,1),0,this.pageRenderer.pagesSize.height-this.pageRenderer.containerRect.height/this.pageRenderer.scale))}async preview(t,s){var r;if(t.resourceType===ae.WhiteboardConvert||t.resourceType===ae.WhiteboardProjector){const i=await je({dynamic:!1,resourceType:t.resourceType,meta:t.meta});(r=i.progress)!=null&&r.convertedFileList&&(this.pagesScrollTop$.setValue(0),this.pages$.setValue(i.progress.convertedFileList.map(o=>({width:o.width,height:o.height,src:o.conversionFileUrl,thumbnail:o.preview||o.conversionFileUrl})))),s.appendChild(this.$docsViewer)}}async destroy(){this.disposable.flushAll(),this.$docsViewer.remove(),this.pagesScrollTop$.destroy(),this.pages$.destroy(),this.pagesSize$.destroy(),this.pageRenderer.destroy(),this.viewer.destroy()}}class bs{constructor(){w(this,"staticDocsViewer")}async preview(t,s){await(this.staticDocsViewer||(this.staticDocsViewer=new gs)).preview(t,s)}async destroy(){var t;(t=this.staticDocsViewer)==null||t.destroy()}}export{bs as FilePreviewNetless};
//# sourceMappingURL=index.6e5672c4.js.map
